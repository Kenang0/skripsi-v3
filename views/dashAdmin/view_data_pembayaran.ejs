<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    .kotak-tabel {
        padding-top: 10px;
        background-color: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        display: flex;
        flex-direction: column;
        padding-bottom: 20px;
        margin-left: 10px;
        margin-right: 10px;
    }

       .kotak-header {
        background-color: #c9c6c6ad;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #ddd;
    }

</style> 
<div class="tabel-data-pembayaran">
  <div class="kotak-tabel">
    <div class="kotak-header">
      <h5>Pengecekan Pembayaran</h5>
    </div>
 <table id="tabel-pengecekan" class="table table-bordered table-striped">
   <thead class="table-primary">
        <tr>
            <th>No</th>
            <th>ID Pemesanan</th>
            <th>Pemilik Produk</th>
            <th>Kategori</th>
            <th>Nama Produk</th>
            <th>harga produk</th>
            <th>dipesan oleh</th>
            <th>Jumlah Pemesanan</th>
            <th>Total Harga</th>
            <th>Terbayar</th>
            <th>Sisa Tagihan</th>
            <th>Status</th>
            <th>Waktu</th>
            <th>bukti pembayaran</th>
        </tr>
    </thead>
    <tbody>
        <% if (data.length > 0) { %>
        <% data.forEach((d, i)=> { %>
            <tr>
                <td>
                    <%= i + 1 %>
                </td>
                <td>
                    <%= d.id_pemesanan %>
                </td>
                <td>
                    <%= d.pemilik_produk %>
                </td>
                <td>
                    <%= d.tipe_kategori %>
                </td>
                <td>
                    <%= d.nama_produk %>
                </td>
                <td>RP <%= d.harga.toLocaleString() %></td>
                <td><%= d.full_name %></td>
                <td>
                    <%= d.jumlah_pemesanan %>
                </td>
                <td>Rp <%= d.total_harga.toLocaleString() %>
                </td>
                <td>
                    <% if (d.total_terbayar !==null) { %>
                        <% if (d.sisa_tagihan) { %>
                            Rp <%= (d.total_terbayar - d.sisa_tagihan).toLocaleString() %>
                                <% } else { %>
                                    Rp <%= Number(d.total_terbayar).toLocaleString() %>
                                        <% } %>
                                            <% } else { %>
                                                <em>-</em>
                                                <% } %>
                </td>

                <td>
                    <%= d.sisa_tagihan ? `Rp ${d.sisa_tagihan.toLocaleString()}` : '-' %>
                </td>
                <td>
                    <%= d.status_pembayaran %>
                </td>
                <td>
                    <%= d.waktu_dibayar.toLocaleDateString("id-ID")  %>
                </td>
                <td>
                    <% if (d.bukti_pembayaran) { %>
                        <button class="btn btn-sm btn-primary" data-bs-toggle="modal"
                            data-bs-target="#buktiModal-<%= d.id_pemesanan %>">
                            Lihat Bukti
                        </button>

                        <!-- Modal -->
                        <div class="modal fade" id="buktiModal-<%= d.id_pemesanan %>" tabindex="-1">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Bukti Pembayaran</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body text-center">
                                        <img src="/uploads/bukti/<%= d.bukti_pembayaran %>" class="img-fluid" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <% } else { %>
                            <em>-</em>
                            <% } %>
                </td>
            </tr>
            <% }) %>
            <% } else { %>
            <tr>
              <td colspan="14" class="text-center">Tidak Pengecekan Pembayaran.</td>
            </tr>
          <% } %>
    </tbody>
</table>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>